<!-- Copyright (c) 2019-2020 十三 all rights reserved. -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{mall/header::head-fragment('NewBee商城-我的优惠券列表','my-coupons')}">
</head>
<body>
<header th:replace="~{mall/header::header-fragment}"></header>
<!-- nav -->
<nav th:replace="~{mall/header::nav-fragment}"></nav>

<!-- personal -->
<div id="personal">
    <div class="self-info center">

        <!-- sidebar -->
        <div th:replace="~{mall/personal-sidebar::sidebar-fragment}"></div>

        <div class="intro fr">
            <div class="uc-box uc-main-box">
                <div class="uc-content-box coupon-list-box">
                    <div class="box-hd">
                        <h1 class="title">我的优惠券
                            <small>请谨防钓鱼链接或诈骗电话，<a href="##">了解更多&gt;</a>
                            </small>
                        </h1>
                    </div>
                    <div class="box-bd">
                        <div class="quan-list">
                            <th:block th:if="${#lists.isEmpty(pageResult.list)}">
                                <img style="margin-top: 16px;"
                                     th:src="@{/mall/image/null-content.png}">
                            </th:block>
                            <th:block th:unless="${#lists.isEmpty(pageResult.list)}">

                                <th:block th:each="coupon : ${pageResult.list}">
                                    <div class="quan-item quan-d-item">
                                        <div class="q-type">
                                            <div class="q-price q-price-active">
                                                <em>￥</em>
                                                <strong class="num" th:text="${coupon.discount}">360</strong>
                                                <div class="txt">
                                                    <div class="typ-txt" th:text="${coupon.couponName} + ${coupon.used?' 已使用':' 未使用'}">
                                                        newbee券
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="limit">
                                            <span class="t-span" th:text="'满' + ${coupon.min} + '元可用'">
                                                满1000元可用
                                            </span>
                                            </div>
                                            <div class="q-range">
                                                <div class="range-item">
                                                    <th:block th:if="${coupon.goodsType == 0}">全平台可用</th:block>
                                                    <th:block th:if="${coupon.goodsType == 1}">指定分类可用</th:block>
                                                    <th:block th:if="${coupon.goodsType == 2}">指定商品可用</th:block>
                                                </div>
                                                <div class="range-item" coupon-time="753151009"
                                                     th:text="${coupon.couponStartTime} + ' ' + ${coupon.couponEndTime}">
                                                    2021.01.15-2021.01.18
                                                </div>
                                            </div>
                                        </div>
                                        <div class="q-lable q-active">
                                            <a href="##" class="op-del"
                                               th:onclick="'deleteCoupon(' + ${coupon.couponUserId} +')'">X</a>
                                            <b class="semi-circle"></b>
                                        </div>
                                    </div>
                                </th:block>

                                <th:block th:unless="${#lists.isEmpty(pageResult.list)}">
                                    <div id="page">
                                        <div class="newbee-pagenavi">
                                            <a th:if="${pageResult.currPage != 1}"
                                               class="numbers"
                                               th:href="@{'/myCoupons?page=1'}">
                                                首页
                                            </a>
                                            <a th:if="${pageResult.currPage != 1}"
                                               class="numbers"
                                               th:href="@{'/myCoupons?page=' + ${pageResult.currPage-1}}">
                                                <
                                            </a>

                                            <th:block th:if="${pageResult.totalPage <= 5 && pageResult.currPage <= 5}">
                                                <th:block th:each="index : ${#numbers.sequence(1, pageResult.totalPage)}">
                                                    <a th:href="@{'/myCoupons?page=' + ${index}}"
                                                       class="numbers"
                                                       th:classappend="${index == pageResult.currPage ? 'current' : ''}"
                                                       th:text="${index}">1</a>
                                                </th:block>
                                            </th:block>

                                            <th:block th:if="${pageResult.totalPage > 5 && pageResult.currPage <= 3}">
                                                <th:block th:if="${pageResult.currPage <= 3}"
                                                          th:each="index : ${#numbers.sequence(1, 5)}">
                                                    <a th:href="@{'/myCoupons?page=' + ${index}}"
                                                       class="numbers"
                                                       th:classappend="${index == pageResult.currPage ? 'current' : ''}"
                                                       th:text="${index}">1</a>
                                                </th:block>
                                            </th:block>

                                            <th:block th:if="${pageResult.totalPage > 5 && pageResult.currPage > 3}">
                                                <th:block th:if="${pageResult.currPage-2 >=1}"><a
                                                        class="numbers"
                                                        th:href="@{'/myCoupons?page=' + ${pageResult.currPage-2}}"
                                                        th:text="${pageResult.currPage -2}">1</a>
                                                </th:block>
                                                <th:block th:if="${pageResult.currPage-1 >=1}"><a
                                                        class="numbers"
                                                        th:href="@{'/myCoupons?page=' + ${pageResult.currPage-1}}"
                                                        th:text="${pageResult.currPage -1}">1</a>
                                                </th:block>
                                                <a href="##" class="numbers current" th:text="${pageResult.currPage}">1</a>
                                                <th:block th:if="${pageResult.currPage+1<=pageResult.totalPage}"><a
                                                        class="numbers"
                                                        th:href="@{'/myCoupons?page=' + ${pageResult.currPage+1}}"
                                                        th:text="${pageResult.currPage +1}">1</a></th:block>
                                                <th:block th:if="${pageResult.currPage+2<=pageResult.totalPage}"><a
                                                        class="numbers"
                                                        th:href="@{'/myCoupons?page=' + ${pageResult.currPage+2}}"
                                                        th:text="${pageResult.currPage +2}">1</a></th:block>
                                            </th:block>

                                            <a th:if="${pageResult.currPage != pageResult.totalPage}"
                                               class="numbers"
                                               th:href="@{'/myCoupons?page=' + ${pageResult.currPage+1}}">
                                                >
                                            </a>
                                            <a th:if="${pageResult.currPage != pageResult.totalPage}"
                                               class="numbers"
                                               th:href="@{'/myCoupons?page=' + ${pageResult.totalPage}}">
                                                尾页
                                            </a>

                                        </div>
                                    </div>
                                </th:block>

                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="clear"></div>
</div>
</div>

<div th:replace="~{mall/footer::footer-fragment}"></div>

<!-- jQuery -->
<script th:src="@{/admin/plugins/jquery/jquery.min.js}"></script>
<!-- sweetalert -->
<script th:src="@{/admin/plugins/sweetalert/sweetalert.min.js}"></script>
<script th:src="@{/mall/js/search.js}" type="text/javascript"></script>
<script>
    function deleteCoupon(couponUserId) {
        swal({
            title: "确认弹框",
            text: "确认要删除该优惠券吗?",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then((flag) => {
                if (flag) {
                    $.ajax({
                        type: "DELETE",
                        url: "coupon/" + couponUserId,
                        contentType: "application/json",
                        success: function (r) {
                            if (r.resultCode == 200) {
                                location.reload();
                            } else {
                                swal(r.message, {
                                    icon: "error",
                                });
                            }
                        }
                    });
                }
            }
        )
    }
</script>
</body>
</html>
